
# Replication bit

# Load packages
library(foreign)
library(stargazer)
library(tidyverse)
library(Hmisc)
library(readstata13)
library(haven)
library(texreg)
library(xtable)
library(knitr)
install.packages("vtable")
library(vtable)
install.packages("plm")
Yes
library(plm)
install.packages("dplyr")
library(dplyr)
install.packages("magrittr")
library(magrittr)

# Set directory
setwd("/Users/yangshuya/Desktop/Jasmine Yang/PhD/Econometrics 2/Replication/Replication/data")
DF <- read.dta13("yearly-obs.dta")

order(DF$fips, DF$year)

# First look at data
head(DF)
summary(DF$repsharey)
summary(DF)

# Creating summary statistics table (table 1)

DF_sum <- c("repshare", "turnout", "popsd", "capital_state", "airport", 
            "lnincome", "poverty", "gini", "racialhhi", "mentalhealth", 
            "pop15t39", "nevermarried", "sc", "lnhom_gun", "lnsui_gun", 
            "lncrime_violent", "lncrime_proprty")
            
sumdata <- DF[DF_sum]

labs <- c("Republican share", "Turnout", 
          "Population (standardized)", "State capitol",
          "Major city", "Log (median HH income)", 
          "Poverty rate","Inequality (Gini Index)", 
          "Racial diversity HHI", 
          "Proportion with mental issues", 
          "Population 15 to 39 years", "Single",
          "College dropouts", "Log (homicides by gun)", 
          "Log (suicides by Gun)","Log (violent crime)",
          "Log (property crime)")

st(sumdata, add.median=TRUE, labels=labs, 
   digits = 2, fixed.digits = FALSE, numformat = NA, out="latex", 
   title='Summary Statistics')

# Table 2
# Checking if counties with/without mass shootings and counties with
# successful vs. failed mass shootings are different in observable
# characteristics

# Run regression with cluster-robust standard errors
# Generate lag 1 republican share variable

DF <- DF %>% mutate(lag1_repshare = lag(repshare))

reg <- plm(lag1_repshare ~ ms + popsd, data = DF, 
           subset = mse == 0 | ms == 1, index = "fips", model = "random", 
           effect = "twoways", cluster = "group")


